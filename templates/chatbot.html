{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<title>Green Bot</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #f4f7f9;
        font-family: "Poppins", sans-serif;
    }

    .chat-container {
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .chat-header {
        background: #1b4332;
        color: white;
        padding: 15px;
        font-size: 20px;
        text-align: center;
        font-weight: bold;
    }

    #chat-box {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .message {
        max-width: 70%;
        padding: 12px;
        border-radius: 10px;
    }

    .user-msg {
        background: #d8f3dc;
        align-self: flex-end;
    }

    .bot-msg {
        background: #e9ecef;
        align-self: flex-start;
    }

    .chat-input {
        display: flex;
        padding: 10px;
        background: #e8e8e8;
    }

    #user-input {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 8px;
    }

    #send-btn {
        padding: 10px;
        margin-left: 5px;
        background: #1b4332;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
</style>
</head>

<body>

<div class="chat-container">

    <div class="chat-header">ðŸŒ¿ Green Bot</div>

    <div id="chat-box"></div>

    <div class="chat-input">
        <input type="text" id="user-input" placeholder="Type your message...">
        <button id="send-btn">Send</button>
    </div>

</div>

<script>
function appendMessage(sender, message) {
    const msg = $('<div class="message"></div>');
    msg.addClass(sender === 'user' ? 'user-msg' : 'bot-msg');
    msg.text(message);
    $('#chat-box').append(msg);
    $('#chat-box').scrollTop($('#chat-box')[0].scrollHeight);
}

$('#send-btn').click(function () {
    const text = $('#user-input').val().trim();
    if (!text) return;

    appendMessage('user', text);
    $('#user-input').val('');

    $.ajax({
        url: "{% url 'chatbot_response' %}",
        type: 'POST',
        data: {
            message: text,
            csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function (data) {
            appendMessage('bot', data.response);
        }
    });
});
</script>

</body>
</html>
